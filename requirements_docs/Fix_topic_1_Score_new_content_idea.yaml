kind: AdaptiveDialog
modelDescription: This topic is triggered when a user uses any of the following phrases "analyse a new idea" , "run PAVE score", or "score this keyword"
beginDialog:
  kind: OnRecognizedIntent
  id: main
  intent: {}
  actions:
    - kind: SetVariable
      id: setVariable_dMTvZU
      variable: Global.openBrace
      value: "{"

    - kind: SetVariable
      id: setVariable_13YUvG
      variable: Global.closeBrace
      value: "}"

    - kind: Question
      id: Question_PqNIu1
      variable: Topic.keyword
      prompt: What is the primary keyword or topic you would like me to analyse?
      entity: StringPrebuiltEntity

    - kind: SearchAndSummarizeContent
      id: j7zazr
      variable: Topic.search_summary
      userInput: =Topic.keyword
      additionalInstructions: "Based on a web search, please provide a detailed summary of the top 5 organic search results for the keyword: {Topic.keyword}."
      webBrowsing: true

    - kind: SearchAndSummarizeContent
      id: akk2I4
      variable: Topic.analysis_json
      userInput: =Topic.keyword
      additionalInstructions: |
        You are an expert SEO Analyst. Analyze the keyword: {Topic.keyword}
        Search Context: {Topic.search_summary}

        Generate a P.A.V.E. score in strict JSON.
        CRITICAL: Limit "reasoning" text to maximum 15 words per score.

        Output format must be strictly this JSON structure:
        {Global.openBrace}
        "profitability_score": 3,
        "profitability_reasoning": "reasoning text...",
        "authority_score": 2,
        "authority_reasoning": "reasoning text...",
        "effort_score": 4,
        "effort_reasoning": "reasoning text...",
        "volume_score": 0,
        "volume_reasoning": "Manual check required.",
        "search_summary": "summary text...",
        "ai_reasoning": "reasoning text..."
        {Global.closeBrace}

    - kind: ParseValue
      id: 7ZLISk
      variable: Topic.Parsed_Scores
      valueType:
        kind: Record
        properties:
          ai_reasoning: String
          authority_reasoning: String
          authority_score: Number
          effort_reasoning: String
          effort_score: Number
          profitability_reasoning: String
          profitability_score: Number
          search_summary: String
          volume_reasoning: String
          volume_score: Number

      value: =Topic.analysis_json
      errorPolicy: DefaultBlank

    - kind: AdaptiveCardPrompt
      id: BQS8N6
      interruptionPolicy:
        allowInterruption: false

      card: |-
        ={
          type: "AdaptiveCard",
          '$schema': "http://adaptivecards.io/schemas/adaptive-card.json",
          version: "1.5",
          body: [
            {
              type: "TextBlock",
              text: "AI-Assisted P.A.V.E. Score",
              weight: "Bolder",
              size: "Large"
            },
            {
              type: "TextBlock",
              text: "Profitability (P)",
              weight: "Bolder",
              separator: true
            },
            {
              type: "TextBlock",
              text: "Reasoning: " & Topic.Parsed_Scores.profitability_reasoning,
              wrap: true,
              isSubtle: true
            },
            {
              type: "Input.Number",
              id: "final_p_score",
              label: "Final P Score",
              value: Topic.Parsed_Scores.profitability_score,
              min: 1,
              max: 5
            },
            {
              type: "TextBlock",
              text: "Authority (A)",
              weight: "Bolder",
              separator: true
            },
            {
              type: "TextBlock",
              text: "Reasoning: " & Topic.Parsed_Scores.authority_reasoning,
              wrap: true,
              isSubtle: true
            },
            {
              type: "Input.Number",
              id: "final_a_score",
              label: "Final A Score",
              value: Topic.Parsed_Scores.authority_score,
              min: 1,
              max: 5
            },
            {
              type: "TextBlock",
              text: "Volume (V) - Manual Entry Required",
              weight: "Bolder",
              separator: true,
              color: "Attention"
            },
            {
              type: "TextBlock",
              text: "Reasoning: " & Topic.Parsed_Scores.volume_reasoning,
              wrap: true
            },
            {
              type: "Input.Number",
              id: "final_v_score",
              label: "Final V Score",
              placeholder: "Check volume & enter 1-5",
              min: 1,
              max: 5
            },
            {
              type: "TextBlock",
              text: "Effort (E)",
              weight: "Bolder",
              separator: true
            },
            {
              type: "TextBlock",
              text: "Reasoning: " & Topic.Parsed_Scores.effort_reasoning,
              wrap: true,
              isSubtle: true
            },
            {
              type: "Input.Number",
              id: "final_e_score",
              label: "Final E Score",
              value: Topic.Parsed_Scores.effort_score,
              min: 1,
              max: 5
            }
          ],
          actions: [
            {
              type: "Action.Submit",
              title: "Confirm & Save to Backlog"
            }
          ]
        }
      output:
        binding:
          actionSubmitId: Topic.actionSubmitId
          final_a_score: Topic.final_a_score
          final_e_score: Topic.final_e_score
          final_p_score: Topic.final_p_score
          final_v_score: Topic.final_v_score

      outputType:
        properties:
          actionSubmitId: String
          final_a_score: Number
          final_e_score: Number
          final_p_score: Number
          final_v_score: Number

    - kind: InvokeFlowAction
      id: invokeFlowAction_Ao8yiq
      input:
        binding:
          number: =Topic.final_p_score
          number_1: =Topic.final_a_score
          number_2: =Topic.final_v_score
          number_3: =Topic.final_e_score
          text: =Topic.keyword
          text_1: =Topic.Parsed_Scores.ai_reasoning
          text_2: =Topic.Parsed_Scores.search_summary

      output: {}
      flowId: 60755c45-5de7-f011-8406-7c1e520307a0

    - kind: SendActivity
      id: sendActivity_Vzfdsx
      activity: Great! I've saved {Topic.keyword} to the backlog. When you're ready to create a content brief, just tell me to 'create a brief'.

    - kind: EndConversation
      id: yB61lk

inputType: {}
outputType: {}